<!DOCTYPE html>
<html>
  <head>
    <title>Lista de Productos</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
      .product-card {
        border: 1px solid #333;
        padding: 10px;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Lista de Productos</h1>

    <h2>Subir imagen</h2>
    <form id="upload-form">
      <input type="file" id="image-upload" />
      <button type="submit">Subir</button>
    </form>

    <h2>Crear producto</h2>
    <form id="product-form" disabled>
      <label>
        Nombre:
        <input type="text" id="product-name" disabled />
      </label>
      <label>
        Precio:
        <input type="text" id="product-price" disabled />
      </label>
      <button type="submit" disabled>Crear</button>
    </form>

    <div id="product-list"></div>

    <script>
      var uploadedImageSrc;

      document
        .getElementById("upload-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          var imageInput = document.getElementById("image-upload");
          var formData = new FormData();
          formData.append("image", imageInput.files[0]);

          axios
            .post("http://localhost:3000/api/v1/products/upload", formData, {
              headers: {
                "Content-Type": "multipart/form-data",
              },
            })
            .then(function (response) {
              console.log(response.data);
              uploadedImageSrc = response.data.image.src;
              document
                .getElementById("product-form")
                .removeAttribute("disabled");
              document
                .getElementById("product-name")
                .removeAttribute("disabled");
              document
                .getElementById("product-price")
                .removeAttribute("disabled");
              document
                .querySelector("#product-form button")
                .removeAttribute("disabled");
              alert("Imagen subida con éxito: " + uploadedImageSrc);
            })
            .catch(function (error) {
              console.log(error);
              alert("Error al subir la imagen");
            });
        });

      document
        .getElementById("product-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          var nameInput = document.getElementById("product-name");
          var priceInput = document.getElementById("product-price");

          axios
            .post("http://localhost:3000/api/v1/products", {
              name: nameInput.value,
              price: priceInput.value,
              image: uploadedImageSrc,
            })
            .then(function (response) {
              console.log(response.data);
              alert("Producto creado con éxito");
            })
            .catch(function (error) {
              console.log(error);
              alert("Error al crear el producto");
            });
        });

      // Aquí va el código que ya tienes para obtener y mostrar la lista de productos.
    </script>
  </body>
</html>
